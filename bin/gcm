#!/bin/sh
# gcm
# Created: Sat Jan  1 14:54:35 MYT 2011

me=`basename $0`
usage() {
    echo -n "Usage: $me [-f] [-h]

    -f        Ignore whitespace errors
    -h        Show this help message
"
}

further_edit=
do_diff_check=t
while getopts efh opt
do
  case "$opt" in
    e) further_edit=--edit;;
    f) do_diff_check=;;
    h) usage ; exit;;
    \?) echo Unknown option ; exit;;
  esac
done
shift $(($OPTIND -1))

if [ -n "$do_diff_check" ]; then
	git diff --cached --check || exit 1
fi

if [ -n "$1" ]; then
	msg=$(git number -c echo "$*") &&
	if [ -e .gcmprefix ]; then
		msg="$(head -1 .gcmprefix|awk '{print $1}') $msg"
	fi &&
	git commit $further_edit -m "$msg"
else
	git commit
fi
